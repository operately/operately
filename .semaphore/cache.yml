version: v1.0
name: Populate CI Cache
agent:
  machine:
    type: f1-standard-4
    os_image: ubuntu2004

blocks:
  - name: Populate CI Cache
    task:
      secrets:
        - name: ci-cache-credentials
      jobs:
        - name: "Populate CI Cache"
          commands:
            - checkout
            - make test.build
            - ./scripts/ci-cache push-dir app/deps app-deps.tar.gz
            - ./scripts/ci-cache push-dir app/_build app-build.tar.gz
            - ./scripts/ci-cache push-dir app/node_modules app-node-modules.tar.gz
            - ./scripts/ci-cache push-image operately-dev:latest docker-operately-dev.tar.gz
